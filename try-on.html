<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Виртуальная примерка — Karl Barbini</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b0b0c;--card:#111113;--gold:#c9a254;--gold-2:#d8b572;--text:#efefef;--muted:#b7ab98;}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,sans-serif}
    header{display:flex;justify-content:space-between;align-items:center;padding:20px}
    .brand-name{font-family:"Cormorant Garamond",serif;font-weight:700;letter-spacing:.12em}
    .brand-slogan{font-size:12px;letter-spacing:.18em;color:var(--muted);text-transform:uppercase;font-style:italic}
    nav a{margin-left:20px;color:var(--text);text-decoration:none;opacity:.9}
    h1{font-family:"Cormorant Garamond",serif;text-align:center;margin:20px 0 10px}
    .wrap{max-width:560px;margin:0 auto 40px;padding:0 16px}
    form{background:var(--card);padding:20px;border-radius:14px;box-shadow:0 18px 36px rgba(0,0,0,.5)}
    label{display:block;margin:12px 0 6px}
    input[type="file"],select,input[type="text"]{width:100%;padding:12px;border-radius:10px;border:1px solid #222;background:#0f0f10;color:var(--text)}
    .consent{display:flex;gap:10px;align-items:flex-start;margin:10px 0 16px}
    .btn{display:inline-block;background:linear-gradient(135deg,var(--gold),var(--gold-2));color:#111;padding:12px 18px;border-radius:999px;font-weight:700;border:none;cursor:pointer}
    .btn[disabled]{opacity:.5;cursor:not-allowed}
    #result{margin-top:20px;text-align:center}
    #result img{max-width:100%;border-radius:12px;box-shadow:0 18px 36px rgba(0,0,0,.5)}
    .note{font-size:13px;color:var(--muted)}
    footer{border-top:1px solid rgba(255,255,255,.1);padding:20px;text-align:center;color:#aaa}
    .spinner{margin:14px auto;width:32px;height:32px;border:3px solid #333;border-top-color:var(--gold);border-radius:50%;animation:sp 1s linear infinite}
    @keyframes sp{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <header>
    <div>
      <div class="brand-name">KARL BARBINI</div>
      <div class="brand-slogan">NO ONE BUT YOU</div>
    </div>
    <nav>
      <a href="index.html">Коллекции</a>
      <a href="black-dress.html">Черное платье</a>
      <a href="white-dress.html">Белое платье</a>
    </nav>
  </header>

  <main class="wrap">
    <h1>Виртуальная примерка</h1>
    <p class="note" style="text-align:center;margin:-6px 0 16px">Загрузите портрет, выберите платье и оставьте контакт. Мы подменим лицо на фото модели.</p>

    <form id="tryonForm">
      <label>Фото лица (портрет, без сильных теней)</label>
      <input type="file" name="photo" accept="image/*" required>

      <label>Выберите платье</label>
      <select name="dress">
        <option value="black">Черное — Elegance in Power</option>
        <option value="white">Белое — Created for Leaders</option>
      </select>

      <label>Контакт для связи (Telegram @username или WhatsApp +7…)</label>
      <input type="text" name="contact" placeholder="@username или +7999…" required>

      <div class="consent">
        <input type="checkbox" id="agree" required>
        <label for="agree" class="note">Согласен(на) на обработку изображения исключительно для виртуальной примерки.</label>
      </div>

      <button class="btn" id="submitBtn" type="submit">Примерить платье</button>
      <div id="loading" style="display:none"><div class="spinner"></div><div class="note">Обрабатываем…</div></div>
    </form>

    <div id="result"></div>
  </main>

  <footer>© 2025 Karl Barbini</footer>

  <script>
    // ТВОЙ боевой бэкенд на Render:
    const API_BASE = "https://kb-tryon-backend.onrender.com";

    const form = document.getElementById("tryonForm");
    const btn = document.getElementById("submitBtn");
    const loading = document.getElementById("loading");
    const result = document.getElementById("result");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      result.innerHTML = "";
      btn.disabled = true;
      loading.style.display = "block";

      try {
        const formData = new FormData(form);
        const res = await fetch(`${API_BASE}/api/tryon`, {
          method: "POST",
          body: formData
        });
        const data = await res.json();

        if (data.output_url) {
          result.innerHTML = `
            <p class="note">Результат:</p>
            <img src="${data.output_url}" alt="Результат примерки">
            <div style="margin-top:12px">
              <a class="btn" href="${data.output_url}" download>Скачать</a>
            </div>`;
        } else {
          result.innerHTML = `<p class="note" style="color:#f77">Ошибка: ${data.error || 'Не удалось обработать изображение'}</p>`;
          console.log("Details:", data.details || data.raw || "");
        }
      } catch (err) {
        result.innerHTML = `<p class="note" style="color:#f77">Сбой сети. Попробуйте ещё раз.</p>`;
        console.error(err);
      } finally {
        btn.disabled = false;
        loading.style.display = "none";
      }
    });
  </script>
</body>
</html>

